#!/usr/bin/env python

import sys
import pykeyvi

from argparse import ArgumentParser

def main():
    argument_parser = ArgumentParser(description='keyvi compiler')

    argument_parser.add_argument('-i', '--input-file', type=str, default=None,
                                 help='input file', required=True)

    argument_parser.add_argument('-o', '--output-file', type=str, default=None,
                                 help='output file', required=True)

    argument_parser.add_argument('-d', '--dictionary-type', type=str, default='json',
                                 choices=['key-only', 'string', 'json'],
                                 help='dictionary type', required=False)

    args = argument_parser.parse_args()

    dictionary_type = args.dictionary_type

    if dictionary_type == 'json':
        dictionary_compiler = pykeyvi.JsonDictionaryCompiler()
    elif dictionary_type == 'string':
        dictionary_compiler = pykeyvi.StringDictionaryCompiler()
    elif dictionary_type == 'key-only':
        dictionary_compiler = pykeyvi.KeyOnlyDictionaryCompiler()
    else:
        print 'Error:'
        return 1


    with open(args.input_file) as input_file:
        for line in input_file:
            line = line.strip('\n')
            if dictionary_type == 'key-only':
                dictionary_compiler.Add(line)
            else:
                key, value = line.split()
                dictionary_compiler.Add(key, value)

    dictionary_compiler.Compile()
    dictionary_compiler.WriteToFile(args.output_file)

    return 0


if __name__ == '__main__':
    sys.exit(main())
